# yaml-language-server: $schema=https://raw.githubusercontent.com/fern-api/fern/main/fern.schema.json

imports:
  http: http.yml
  types: types.yml
  commons: commons.yml
types:
  EnvironmentVariable: string
  ApiAuth:
    extends: commons.WithDocs
    properties:
      requirement: AuthSchemesRequirement
      schemes: list<AuthScheme>
  AuthSchemesRequirement:
    enum:
      - ALL
      - ANY
  AuthScheme:
    discriminant:
      value: _type
      name: type
    union:
      bearer: BearerAuthScheme
      basic: BasicAuthScheme
      header: HeaderAuthScheme
      oauth: OAuthScheme
  BearerAuthScheme:
    extends: commons.WithDocs
    properties:
      token: commons.Name
      tokenEnvVar:
        type: optional<EnvironmentVariable>
        docs: The environment variable the SDK should use to read the token.
  
  OAuthScheme:
    extends: commons.WithDocs
    docs: Note that for the oauth scheme we are currently assuming the resultant token is leveraged as a bearer token, e.g. "Authorization Bearer
    properties:
      configuration: OAuthConfiguration
  OAuthConfiguration:
    union:
      authorizationCode: AuthorizationCodeOAuthScheme
      clientCredentials: ClientCredentialsOAuthScheme
  OauthAccessTokenFields:
    docs: The fields to map to the corresponding OAuth token primitive.
    properties:
      accessToken: string
      expiresIn: optional<long>
      refreshToken: optional<string>
  OauthRefreshTokenFields:
    docs: The fields to map to the corresponding OAuth token primitive.
    properties:
      refreshToken: string
  EndpointReference:
    properties:
      method: http.HttpMethod
      path: http.HttpPath
  OauthTokenEndpoint:
    properties:
      endpointReference:
        type: EndpointReference
        docs: |
          The refrence to the access token endpoint. This is specifically the endpoint ID without the `endpoint_` prefix.
          This is gotten by following the path to the file the endpoint is defined in, so if the endpoint `get_token` is defined in foo/service.yml,
          the endpoint ID would be `foo/service.get_token`.
      responseFields: OauthAccessTokenFields
  OauthRefreshEndpoint:
    properties:
      endpointReference:
        type: EndpointReference
        docs: |
          The refrence to the refresh token endpoint. This is specifically the endpoint ID without the `endpoint_` prefix.
          This is gotten by following the path to the file the endpoint is defined in, so if the endpoint `refresh_token` is defined in foo/service.yml,
          the endpoint ID would be `foo/service.refresh_token`.
      requestFields: OauthRefreshTokenFields
      responseFields: OauthAccessTokenFields
  OauthAuthorizationEndpointParameters:
    properties:
      name: commons.NameAndWireValue
      type: types.TypeReference
  OauthAuthorizationEndpoint:
    properties:
      path:
        type: string
        docs: The path to append to the base URL to get the authorization endpoint a user is meant to visit within the browser.
      queryParameters: optional<list<OauthAuthorizationEndpointParameters>>
  ClientCredentialsOAuthScheme:
    extends: BaseOAuthScheme
    properties:
      tokenEndpoint: OauthTokenEndpoint
      refreshEndpoint: optional<OauthRefreshEndpoint>
  AuthorizationCodeOAuthScheme:
    extends: BaseOAuthScheme
    properties:
      authorizationCodeEnvVar: optional<EnvironmentVariable>
      authorizationEndpoint: OauthAuthorizationEndpoint
      tokenEndpoint: OauthTokenEndpoint
      refreshEndpoint: optional<OauthRefreshEndpoint>
  BaseOAuthScheme:
    properties:
      clientIdEnvVar: optional<EnvironmentVariable>
      clientSecretEnvVar: optional<EnvironmentVariable>
      tokenPrefix: optional<string>
      scopes: optional<list<string>>
      redirectUri: optional<string>

  BasicAuthScheme:
    extends: commons.WithDocs
    properties:
      username: commons.Name
      usernameEnvVar:
        type: optional<EnvironmentVariable>
        docs: The environment variable the SDK should use to read the username.
      password: commons.Name
      passwordEnvVar:
        type: optional<EnvironmentVariable>
        docs: The environment variable the SDK should use to read the password.
  HeaderAuthScheme:
    extends: commons.WithDocs
    properties:
      name: commons.NameAndWireValue
      valueType: types.TypeReference
      prefix: optional<string>
      headerEnvVar:
        type: optional<EnvironmentVariable>
        docs: The environment variable the SDK should use to read the header.
